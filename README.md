# TS HELP AD

Помощник для службы техподдержки с графическим интерфейсом (Tkinter) для работы с учётными записями и мониторингом звонков FreePBX.
Основной исполняемый файл — `TS HELPER V4.1.py`; предыдущая версия сохранена в репозитории как архивный вариант.

## Возможности
- Управление списком пользователей (добавление, редактирование, импорт/экспорт).
- Синхронизация с Active Directory и проверка доступности хостов.
- Запуск SSH/административных команд с учётом сохранённых настроек.
- Мониторинг звонков (Call Watcher) с парсингом страниц FreePBX.
- Логирование действий в `app.log` и сохранение отладочных дампов PBX в каталоге `_pbx_debug`.

## Требования
- Python 3.9+ (разработка ориентирована на Windows).
- Виртуальная среда (рекомендуется) и зависимости из `requirements.txt`.
- Наличие `tkinter` в установленной сборке Python.
- Для функций шифрования DPAPI и интеграции с AD требуется Windows.
- Для безопасного хранения паролей используется библиотека `keyring` и доступное в системе защищённое хранилище учётных данных.

## Установка и запуск
```bash
python -m venv .venv
source .venv/bin/activate  # или .venv\\Scripts\\activate в Windows
pip install -r requirements.txt
python "TS HELPER V4.1.py"
```

## Настройка
Основные параметры задаются в `config.json`:
- `ad_username` — учётные данные для подключения к AD (пароль хранится в keyring по ссылке из конфигурации).
- `cw_url`, `cw_cookie`, `cw_exts` — доступ к странице статистики FreePBX и отслеживаемые внутренние номера.
- `cw_login` — учётные данные FreePBX (пароль хранится в keyring).
- `ssh_login`, `ssh_terminal` — запуск удалённых сессий (пароль хранится в keyring).
- Геометрия окон (`window_geometry` и др.) сохраняется автоматически при закрытии.

Пароли (`ad_password`, `ssh_password`, `cw_password`, `reset_password`) сохраняются только в защищённом хранилище (keyring); в `config.json` остаются идентификаторы записей. При недоступности keyring пароли не отображаются в настройках, выводится предупреждение и значения хранятся лишь временно/в зашифрованном виде до появления защиты.

Список отображаемых пользователей хранится в `users.json`.

## Известные особенности
- Обновления с GitHub проверяются в фоне; при отсутствии `requests` проверка пропускается.
- Логика DPAPI (`pywin32`) работает только в Windows; на других ОС пароли сохраняются в открытом виде.
- При использовании Call Watcher убедитесь, что cookie FreePBX актуальна, иначе парсинг будет отображать страницу входа.
